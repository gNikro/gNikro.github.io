<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>jsVideoAndChat-</title>
	<meta name="description" content="" />
	
	<link rel="stylesheet" href="mainStyle.min.css" type="text/css">
		
</head>
<body>
	
	<div style="pointer-events: none;" id="ytplayer"></div>
	
	<script>
		/*window.onbeforeunload = function (event) 
		{
			var message = 'Вы уверены, что хотите покинуть страницу трансляции? После этого Вы не сможете зайти в неё повторно!';
			
			if (typeof event == 'undefined') 
			{
				event = window.event;
			}
			
			if (event) 
			{
				event.returnValue = message;
			}
			
			return message;
		}*/
		
		var startTime;
		
		function initVideo(_startTime)
		{
			console.log('init video');
			var tag = document.createElement('script');
			tag.src = "https://www.youtube.com/player_api";
			var firstScriptTag = document.getElementsByTagName('script')[0];
			firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
			
			startTime = _startTime;
		}
	
		var player;
		function onYouTubePlayerAPIReady() 
		{
			player = new YT.Player
			(
				'ytplayer', 
				{
					height: '390',
					width: '640',
					
					
					playerVars: {
						color: 'white',
						controls: '0',
						autohide:'1',
						disablekb:'1',
						showinfo:'0',
						
					},
					
					
					events: {
						onStateChange: onPlayerStateChange,
						onReady: initialize
					}
				}
			);
		}

		function onPlayerStateChange(event)
		{
			if(event.data == YT.PlayerState.PLAYING)
			{
				var duration = player.getDuration() - player.getCurrentTime();
				setTimeout(onVideoEnded, duration * 1000 - 1000);
				//setTimeout(onShowDiv, 2000);
			}
		}
		
		//function onShowDiv()
		//{
		//	document.getElementById("showDiv").hidden = false;
		//}
		
		function onVideoEnded()
		{
			player.destroy();
		}
		
		function initialize()
		{
			player.loadVideoById({
									'videoId': '4o53GdLXH0c',
									'startSeconds': startTime,
									//'endSeconds': 60,
									'suggestedQuality': 'large'});
									
			player.setVolume(0);
		}
		
		
	</script>
	
	<div id="waitingScreen" hidden>
		<div id="waitingTimer">.....</div>
	</div>
	
	<div id="eventEnd" hidden>
		Мероприятие закончилось
	</div>
	
	<div id="container" hidden>
		<div id="usersBlock">
			<div id="usersHeader">Всего участников: {0}</div>
			<div id="users"></div>
		</div>
		
		<div id="chatBlock">
			Чат:
			<div id="chat"></div>
			<input id="chatInput"></div>
		</div>
	</div>
			
	<div>
		 <iframe id="showDiv" src="http://shop.lenovo.com/eg/en/laptops/lenovo/u-series/u430-touch/#tab-tech_specs" width="640" height="300" align="left" hidden>
			
		 </iframe
	</div>
	
	<script src="core.js"></script>
	<!-- <script src="https://www.youtube.com/player_api"></script> -->
</body>
</html>